<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elasticsearch Rally + Coldstart Benchmark Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --graviton: #10b981;
            --intel: #3b82f6;
            --amd: #ef4444;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --muted: #64748b;
            --accent: #f59e0b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }
        .container { max-width: 1600px; margin: 0 auto; padding: 2rem; }
        header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2.5rem;
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 50%, #ef4444 100%);
            color: white;
            border-radius: 1rem;
        }
        header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        header p { opacity: 0.9; font-size: 1.1rem; }
        .meta-info { margin-top: 1rem; font-size: 0.9rem; opacity: 0.8; }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            background: var(--card);
            padding: 0.5rem;
            border-radius: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .tab-btn {
            flex: 1;
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            border-radius: 0.75rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: var(--muted);
            transition: all 0.3s;
        }
        .tab-btn:hover { background: #f1f5f9; color: var(--text); }
        .tab-btn.active { background: var(--accent); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Summary Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .card {
            background: var(--card);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            position: relative;
            overflow: hidden;
        }
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--intel);
        }
        .card.graviton::before { background: var(--graviton); }
        .card.warn::before { background: var(--amd); }
        .card.highlight::before { background: linear-gradient(90deg, var(--accent), #ef4444); }
        .card h3 {
            color: var(--muted);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        .card .value { font-size: 1.75rem; font-weight: 700; color: var(--intel); }
        .card .label { font-size: 0.875rem; color: var(--muted); margin-top: 0.25rem; }
        .card.graviton .value { color: var(--graviton); }
        .card.warn .value { color: var(--amd); }
        .card.highlight .value { color: var(--accent); }

        /* Expandable Card Details */
        .card-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            margin-top: 0;
        }
        .card-details.expanded { max-height: 200px; margin-top: 1rem; }
        .card-details ul {
            list-style: none;
            font-size: 0.85rem;
            color: var(--muted);
        }
        .card-details li {
            padding: 0.25rem 0;
            border-bottom: 1px solid #f1f5f9;
        }
        .card-details li:last-child { border-bottom: none; }
        .expand-btn {
            background: none;
            border: none;
            color: var(--accent);
            font-size: 0.8rem;
            cursor: pointer;
            padding: 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        .expand-btn:hover { text-decoration: underline; }

        /* Chart Section */
        .chart-section {
            background: var(--card);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
        .chart-section h2 { font-size: 1.25rem; margin-bottom: 0.25rem; }
        .chart-section .description { color: var(--muted); margin-bottom: 1rem; font-size: 0.875rem; }
        .chart-container { position: relative; height: 400px; }
        .chart-container.tall { height: 550px; }
        .chart-container.extra-tall { height: 700px; }

        /* Toggle Buttons */
        .toggle-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        .toggle-btn {
            padding: 0.5rem 1rem;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        .toggle-btn:hover { border-color: var(--accent); }
        .toggle-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; }

        /* Insights Box */
        .insights {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid #f59e0b;
            padding: 1.25rem;
            border-radius: 0 0.75rem 0.75rem 0;
            margin: 1.5rem 0;
        }
        .insights h4 { color: #b45309; margin-bottom: 0.75rem; font-size: 1rem; }
        .insights ul { margin-left: 1.5rem; color: #92400e; }
        .insights li { margin-bottom: 0.5rem; }

        /* Highlight Box */
        .highlight-box {
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        .highlight-box h4 { color: #475569; margin-bottom: 1rem; font-size: 1.1rem; }
        .highlight-box ul { margin-left: 1.5rem; color: #64748b; }
        .highlight-box li { margin-bottom: 0.5rem; }

        /* Table */
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 0.85rem; }
        th, td { padding: 0.6rem 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0; }
        th { background: #f8fafc; font-weight: 600; cursor: pointer; position: sticky; top: 0; }
        th:hover { background: #e2e8f0; }
        tr:hover { background: #f8fafc; }
        .badge {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 9999px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .badge.graviton { background: #d1fae5; color: #065f46; }
        .badge.intel { background: #dbeafe; color: #1e40af; }
        .badge.amd { background: #fee2e2; color: #991b1b; }

        /* Filters */
        .filter-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }
        .filter-row select, .filter-row input {
            padding: 0.5rem 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }
        .filter-row input { width: 200px; }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--muted);
            font-size: 0.875rem;
        }

        @media (max-width: 768px) {
            .grid-2 { grid-template-columns: 1fr; }
            .chart-container { height: 300px; }
            .tab-nav { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Elasticsearch 벤치마크 리포트</h1>
            <p>51개 EC2 인스턴스 타입 - Rally 처리량 + 콜드 스타트 성능 (xlarge, 4 vCPU)</p>
            <div class="meta-info">
                EKS 클러스터 | ap-northeast-2 | Elasticsearch 8.11.0 | 인스턴스당 5회 | 2026-01-22
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="showTab('rally')">Rally 벤치마크</button>
            <button class="tab-btn" onclick="showTab('coldstart')">콜드 스타트</button>
            <button class="tab-btn" onclick="showTab('combined')">종합 분석</button>
        </div>

        <!-- Rally Tab -->
        <div id="rally-tab" class="tab-content active">
            <div class="summary-cards">
                <div class="card graviton highlight">
                    <h3>최고 Rally 처리량</h3>
                    <div class="value">76,141 docs/s</div>
                    <div class="label">m8g.xlarge (Graviton4)</div>
                    <button class="expand-btn" onclick="toggleDetails(this)">상세 보기</button>
                    <div class="card-details">
                        <ul>
                            <li>#2: r8g.xlarge - 74,611 docs/s</li>
                            <li>#3: c8g.xlarge - 74,525 docs/s</li>
                            <li>#4: r8i-flex.xlarge - 67,892 docs/s</li>
                            <li>#5: r8i.xlarge - 66,008 docs/s</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3>최고 Intel</h3>
                    <div class="value">67,892 docs/s</div>
                    <div class="label">r8i-flex.xlarge (8세대)</div>
                    <button class="expand-btn" onclick="toggleDetails(this)">상세 보기</button>
                    <div class="card-details">
                        <ul>
                            <li>#2: r8i.xlarge - 66,008 docs/s</li>
                            <li>#3: c7i-flex.xlarge - 65,658 docs/s</li>
                            <li>#4: m8i.xlarge - 65,643 docs/s</li>
                            <li>#5: c8i-flex.xlarge - 65,004 docs/s</li>
                        </ul>
                    </div>
                </div>
                <div class="card graviton">
                    <h3>Graviton 평균</h3>
                    <div class="value">57,844 docs/s</div>
                    <div class="label">16개 인스턴스 (2-4세대)</div>
                </div>
                <div class="card">
                    <h3>Intel 평균</h3>
                    <div class="value">47,520 docs/s</div>
                    <div class="label">31개 인스턴스 (5-8세대)</div>
                </div>
                <div class="card warn">
                    <h3>AMD 평균</h3>
                    <div class="value">31,977 docs/s</div>
                    <div class="label">4개 인스턴스 (5a 시리즈)</div>
                </div>
            </div>

            <div class="insights">
                <h4>Rally 핵심 인사이트</h4>
                <ul>
                    <li><strong>Graviton4 압도적 1위:</strong> Top 3 모두 Graviton4 (8g), m8g.xlarge가 최고 Intel 대비 12% 빠름</li>
                    <li><strong>Flex 모델 우수:</strong> c7i-flex가 c7i 대비 25% 빠름 (65,658 vs 52,310), r8i-flex도 r8i 대비 3% 우위</li>
                    <li><strong>AMD 5a 시리즈 저조:</strong> Intel 평균 대비 33% 느림, JVM 최적화 문제 추정</li>
                    <li><strong>메모리 패밀리 (R) 강세:</strong> r8g, r8i-flex, r8i 상위권 - 대용량 메모리가 ES 인덱싱에 유리</li>
                </ul>
            </div>

            <div class="chart-section">
                <h2>Rally 처리량 Top 20</h2>
                <p class="description">geonames 데이터셋 (1,140만 문서) 인덱싱 처리량 - 높을수록 좋음</p>
                <div class="toggle-group">
                    <button class="toggle-btn active" onclick="updateRallyChart('throughput')">처리량</button>
                    <button class="toggle-btn" onclick="updateRallyChart('latency50')">Latency p50</button>
                    <button class="toggle-btn" onclick="updateRallyChart('latency99')">Latency p99</button>
                    <button class="toggle-btn" onclick="updateRallyChart('gc')">GC 시간</button>
                    <button class="toggle-btn" onclick="updateRallyChart('indexing')">인덱싱 시간</button>
                    <button class="toggle-btn" onclick="updateRallyChart('merge')">머지 시간</button>
                </div>
                <div class="chart-container tall">
                    <canvas id="rallyChart"></canvas>
                </div>
            </div>

            <div class="grid-2">
                <div class="chart-section">
                    <h2>아키텍처별 비교</h2>
                    <p class="description">아키텍처별 Rally 평균 처리량</p>
                    <div class="chart-container">
                        <canvas id="archChart"></canvas>
                    </div>
                </div>
                <div class="chart-section">
                    <h2>세대별 비교</h2>
                    <p class="description">Intel vs Graviton 세대별</p>
                    <div class="chart-container">
                        <canvas id="genChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="chart-section">
                <h2>패밀리별 비교 (C/M/R)</h2>
                <p class="description">컴퓨팅 vs 범용 vs 메모리 최적화</p>
                <div class="chart-container">
                    <canvas id="familyChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Coldstart Tab -->
        <div id="coldstart-tab" class="tab-content">
            <div class="summary-cards">
                <div class="card graviton highlight">
                    <h3>가장 빠른 콜드 스타트</h3>
                    <div class="value">10.69s</div>
                    <div class="label">m8g.xlarge (Graviton4)</div>
                    <button class="expand-btn" onclick="toggleDetails(this)">상세 보기</button>
                    <div class="card-details">
                        <ul>
                            <li>#2: r8g.xlarge - 11.13s</li>
                            <li>#3: c8g.xlarge - 11.13s</li>
                            <li>#4: m7gd.xlarge - 12.27s</li>
                            <li>#5: r8i-flex.xlarge - 12.33s</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3>가장 빠른 Intel</h3>
                    <div class="value">12.33s</div>
                    <div class="label">r8i-flex.xlarge (8세대)</div>
                </div>
                <div class="card graviton">
                    <h3>최고 Bulk 인덱싱</h3>
                    <div class="value">230ms</div>
                    <div class="label">r8g / c8g.xlarge</div>
                </div>
                <div class="card warn">
                    <h3>가장 느린 콜드 스타트</h3>
                    <div class="value">26.69s</div>
                    <div class="label">r5a.xlarge (AMD 5세대)</div>
                </div>
            </div>

            <div class="insights">
                <h4>콜드 스타트 핵심 인사이트</h4>
                <ul>
                    <li><strong>Graviton4 최고속 부팅:</strong> m8g.xlarge (10.69s)가 Intel 평균 (16.68s) 대비 36% 빠름</li>
                    <li><strong>8세대 우세:</strong> Top 5 콜드스타트 중 4개가 8세대 인스턴스</li>
                    <li><strong>AMD 5a 시리즈 가장 느림:</strong> r5a.xlarge (26.69s) 전체 최하위 - JVM/GC 최적화 부족</li>
                    <li><strong>Bulk 인덱싱 상관관계:</strong> 콜드 스타트 빠른 인스턴스가 Bulk 인덱싱도 우수</li>
                </ul>
            </div>

            <div class="chart-section">
                <h2>콜드 스타트 시간 Top 20 (낮을수록 좋음)</h2>
                <p class="description">Elasticsearch 프로세스 시작부터 클러스터 준비 (green 상태)까지</p>
                <div class="toggle-group">
                    <button class="toggle-btn active" onclick="updateColdstartChart('coldstart')">콜드 스타트</button>
                    <button class="toggle-btn" onclick="updateColdstartChart('sequential')">Sequential 인덱싱</button>
                    <button class="toggle-btn" onclick="updateColdstartChart('bulk')">Bulk 인덱싱</button>
                    <button class="toggle-btn" onclick="updateColdstartChart('search_match_all')">Search match_all</button>
                    <button class="toggle-btn" onclick="updateColdstartChart('search_term')">Search term</button>
                </div>
                <div class="chart-container tall">
                    <canvas id="coldstartChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Combined Tab -->
        <div id="combined-tab" class="tab-content">
            <div class="summary-cards">
                <div class="card graviton highlight">
                    <h3>종합 최고 성능</h3>
                    <div class="value">m8g.xlarge</div>
                    <div class="label">Rally 1위 (76K) + Coldstart 1위 (10.7s)</div>
                </div>
                <div class="card graviton">
                    <h3>최고 가성비</h3>
                    <div class="value">c7i-flex.xlarge</div>
                    <div class="label">Intel 7세대 중 최고 효율</div>
                </div>
                <div class="card">
                    <h3>Graviton4 우위</h3>
                    <div class="value">+60%</div>
                    <div class="label">Intel 5세대 대비 Rally 성능</div>
                </div>
                <div class="card warn">
                    <h3>AMD 성능 격차</h3>
                    <div class="value">-33%</div>
                    <div class="label">Intel 평균 대비 처리량</div>
                </div>
            </div>

            <div class="insights">
                <h4>종합 분석 인사이트</h4>
                <ul>
                    <li><strong>강한 상관관계:</strong> 콜드 스타트가 빠른 인스턴스가 Rally 처리량도 높음</li>
                    <li><strong>Graviton4 종합 1위:</strong> m8g.xlarge가 Rally와 Coldstart 모두 1위 차지</li>
                    <li><strong>메모리 효과:</strong> R 패밀리(32GB)가 시작 시간과 인덱싱 모두에서 유리</li>
                    <li><strong>Flex 모델 추천:</strong> Intel flex 변형이 일반 모델보다 가격 대비 성능 우수</li>
                    <li><strong>세대별 진화:</strong> 8세대가 5세대 대비 평균 70% 이상 성능 향상</li>
                </ul>
            </div>

            <div class="chart-section">
                <h2>비용 효율 분석 (Performance per Dollar)</h2>
                <p class="description">시간당 비용 대비 Rally 처리량 - 높을수록 가성비 우수</p>
                <div class="chart-container tall">
                    <canvas id="costEfficiencyChart"></canvas>
                </div>
            </div>

            <div class="chart-section">
                <h2>가격 대비 성능 분석</h2>
                <p class="description">X축: 시간당 비용 ($/hr), Y축: Rally 처리량 (docs/s) - 우상단이 고성능/고가, 좌상단이 가성비 우수</p>
                <div class="chart-container tall">
                    <canvas id="pricePerformanceChart"></canvas>
                </div>
            </div>

            <div class="chart-section">
                <h2>Rally 처리량 vs 콜드 스타트 시간</h2>
                <p class="description">좌상단이 이상적 (빠른 시작, 높은 처리량)</p>
                <div class="chart-container tall">
                    <canvas id="scatterChart"></canvas>
                </div>
            </div>

            <div class="chart-section">
                <h2>세대별 Rally vs Coldstart 비교</h2>
                <p class="description">세대별 두 메트릭 정규화 비교</p>
                <div class="chart-container">
                    <canvas id="combinedGenChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Common: Methodology -->
        <div class="highlight-box">
            <h4>테스트 방법론</h4>
            <ul>
                <li><strong>Rally 벤치마크:</strong> esrally geonames 데이터셋 (1,140만 문서), 단일 노드, index-append 작업</li>
                <li><strong>콜드 스타트:</strong> ES 프로세스 시작부터 HTTP 9200 응답 + 클러스터 green 상태까지</li>
                <li><strong>Elasticsearch:</strong> 8.11.0, 단일 노드 모드, 보안 비활성화</li>
                <li><strong>JVM:</strong> 번들 OpenJDK 21, Heap = 가용 메모리의 60%</li>
                <li><strong>노드 격리:</strong> podAntiAffinity로 벤치마크당 전용 노드 보장</li>
                <li><strong>반복 측정:</strong> 인스턴스당 5회 실행, IQR 기반 이상치 제거 후 평균</li>
            </ul>
        </div>

        <!-- Full Data Table -->
        <div class="chart-section">
            <h2>전체 결과 테이블</h2>
            <div class="filter-row">
                <input type="text" id="searchInput" placeholder="인스턴스 검색..." onkeyup="filterTable()">
                <select id="archFilter" onchange="filterTable()">
                    <option value="">전체 아키텍처</option>
                    <option value="Graviton">Graviton</option>
                    <option value="Intel">Intel</option>
                    <option value="AMD">AMD</option>
                </select>
                <select id="genFilter" onchange="filterTable()">
                    <option value="">전체 세대</option>
                    <option value="2">Graviton2 (6세대)</option>
                    <option value="3">Graviton3 (7세대)</option>
                    <option value="4">Graviton4 (8세대)</option>
                    <option value="5">Intel 5세대</option>
                    <option value="6">Intel 6세대</option>
                    <option value="7">Intel 7세대</option>
                    <option value="8">Intel 8세대</option>
                </select>
                <select id="familyFilter" onchange="filterTable()">
                    <option value="">전체 패밀리</option>
                    <option value="C">C (컴퓨팅)</option>
                    <option value="M">M (범용)</option>
                    <option value="R">R (메모리)</option>
                </select>
            </div>
            <div style="overflow-x: auto;">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th onclick="sortTable(0)">순위</th>
                            <th onclick="sortTable(1)">인스턴스</th>
                            <th onclick="sortTable(2)">아키텍처</th>
                            <th onclick="sortTable(3)">세대</th>
                            <th onclick="sortTable(4)">패밀리</th>
                            <th onclick="sortTable(5)">Rally (docs/s)</th>
                            <th onclick="sortTable(6)">Latency p50</th>
                            <th onclick="sortTable(7)">Latency p99</th>
                            <th onclick="sortTable(8)">인덱싱 (min)</th>
                            <th onclick="sortTable(9)">머지 (min)</th>
                            <th onclick="sortTable(10)">콜드스타트 (s)</th>
                            <th onclick="sortTable(11)">Sequential (ms)</th>
                            <th onclick="sortTable(12)">Bulk (ms)</th>
                            <th onclick="sortTable(13)">Search match_all</th>
                            <th onclick="sortTable(14)">Search term</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Conclusion -->
        <div class="highlight-box">
            <h4>권장 사항</h4>
            <ul>
                <li><strong>최고 성능:</strong> Graviton4 (m8g, r8g, c8g) - 처리량 1위, 콜드 스타트 최고</li>
                <li><strong>최고 Intel:</strong> r8i-flex.xlarge - Flex 모델이 일반 모델 대비 18-25% 우수</li>
                <li><strong>최고 가성비:</strong> c7i-flex.xlarge - 8세대 대비 저렴하면서 높은 처리량</li>
                <li><strong>비추천:</strong> AMD 5a 시리즈 (m5a, r5a, r5ad, m5ad) - Intel 대비 33% 느림</li>
                <li><strong>메모리 패밀리 (R):</strong> ES 워크로드에 추천 - 추가 메모리가 인덱싱 성능 향상</li>
            </ul>
        </div>

        <footer>
            <p>생성일: 2026-01-22 | 리전: ap-northeast-2 | Elasticsearch 8.11.0 | 인스턴스당 5회 측정</p>
        </footer>
    </div>

    <script>
        // Benchmark Data
        const benchmarkData = [
            {"instance":"m8g.xlarge","arch":"Graviton","gen":4,"family":"M","rally_throughput_avg":76141.1,"rally_latency_50_avg":452.2,"rally_latency_99_avg":2720.7,"rally_gc_young_avg":1.43,"indexing_time_avg":32.55,"merge_time_avg":14.76,"coldstart_avg":10691,"sequential_index_avg":1620,"bulk_index_avg":238,"search_match_all_avg":22,"search_term_avg":11},
            {"instance":"r8g.xlarge","arch":"Graviton","gen":4,"family":"R","rally_throughput_avg":74610.6,"rally_latency_50_avg":452.5,"rally_latency_99_avg":2528.9,"rally_gc_young_avg":1.4,"indexing_time_avg":31.0,"merge_time_avg":14.24,"coldstart_avg":11128,"sequential_index_avg":1492,"bulk_index_avg":230,"search_match_all_avg":17,"search_term_avg":10},
            {"instance":"c8g.xlarge","arch":"Graviton","gen":4,"family":"C","rally_throughput_avg":74525.3,"rally_latency_50_avg":458.6,"rally_latency_99_avg":2528.8,"rally_gc_young_avg":1.43,"indexing_time_avg":29.02,"merge_time_avg":16.84,"coldstart_avg":11130,"sequential_index_avg":1640,"bulk_index_avg":230,"search_match_all_avg":19,"search_term_avg":10},
            {"instance":"r8i-flex.xlarge","arch":"Intel","gen":8,"family":"R","rally_throughput_avg":67892.1,"rally_latency_50_avg":509.0,"rally_latency_99_avg":2989.6,"rally_gc_young_avg":2.67,"indexing_time_avg":37.26,"merge_time_avg":15.06,"coldstart_avg":12326,"sequential_index_avg":2505,"bulk_index_avg":264,"search_match_all_avg":15,"search_term_avg":8},
            {"instance":"r8i.xlarge","arch":"Intel","gen":8,"family":"R","rally_throughput_avg":66008.1,"rally_latency_50_avg":515.7,"rally_latency_99_avg":3403.5,"rally_gc_young_avg":2.69,"indexing_time_avg":28.54,"merge_time_avg":10.21,"coldstart_avg":12396,"sequential_index_avg":2161,"bulk_index_avg":526,"search_match_all_avg":15,"search_term_avg":8},
            {"instance":"c7i-flex.xlarge","arch":"Intel","gen":7,"family":"C","rally_throughput_avg":65658.1,"rally_latency_50_avg":533.3,"rally_latency_99_avg":3647.5,"rally_gc_young_avg":2.67,"indexing_time_avg":28.33,"merge_time_avg":13.92,"coldstart_avg":15018,"sequential_index_avg":1875,"bulk_index_avg":290,"search_match_all_avg":16,"search_term_avg":9},
            {"instance":"m8i.xlarge","arch":"Intel","gen":8,"family":"M","rally_throughput_avg":65643.0,"rally_latency_50_avg":521.8,"rally_latency_99_avg":3237.1,"rally_gc_young_avg":2.58,"indexing_time_avg":38.22,"merge_time_avg":16.41,"coldstart_avg":34836,"sequential_index_avg":2297,"bulk_index_avg":327,"search_match_all_avg":16,"search_term_avg":7},
            {"instance":"c8i-flex.xlarge","arch":"Intel","gen":8,"family":"C","rally_throughput_avg":65004.2,"rally_latency_50_avg":499.6,"rally_latency_99_avg":2893.8,"rally_gc_young_avg":2.65,"indexing_time_avg":32.03,"merge_time_avg":15.34,"coldstart_avg":15928,"sequential_index_avg":1408,"bulk_index_avg":266,"search_match_all_avg":13,"search_term_avg":8},
            {"instance":"c7gd.xlarge","arch":"Graviton","gen":3,"family":"C","rally_throughput_avg":63980.4,"rally_latency_50_avg":544.0,"rally_latency_99_avg":3184.4,"rally_gc_young_avg":1.55,"indexing_time_avg":39.72,"merge_time_avg":18.63,"coldstart_avg":12786,"sequential_index_avg":1790,"bulk_index_avg":340,"search_match_all_avg":19,"search_term_avg":10},
            {"instance":"r7g.xlarge","arch":"Graviton","gen":3,"family":"R","rally_throughput_avg":63102.1,"rally_latency_50_avg":536.9,"rally_latency_99_avg":3357.1,"rally_gc_young_avg":1.51,"indexing_time_avg":34.31,"merge_time_avg":13.85,"coldstart_avg":14122,"sequential_index_avg":2011,"bulk_index_avg":320,"search_match_all_avg":20,"search_term_avg":10},
            {"instance":"m7gd.xlarge","arch":"Graviton","gen":3,"family":"M","rally_throughput_avg":62970.9,"rally_latency_50_avg":544.9,"rally_latency_99_avg":2941.9,"rally_gc_young_avg":1.64,"indexing_time_avg":62.3,"merge_time_avg":31.59,"coldstart_avg":12267,"sequential_index_avg":1764,"bulk_index_avg":333,"search_match_all_avg":20,"search_term_avg":11},
            {"instance":"c8i.xlarge","arch":"Intel","gen":8,"family":"C","rally_throughput_avg":62895.6,"rally_latency_50_avg":546.0,"rally_latency_99_avg":4078.3,"rally_gc_young_avg":2.78,"indexing_time_avg":38.21,"merge_time_avg":21.29,"coldstart_avg":14627,"sequential_index_avg":1480,"bulk_index_avg":248,"search_match_all_avg":13,"search_term_avg":7},
            {"instance":"c7g.xlarge","arch":"Graviton","gen":3,"family":"C","rally_throughput_avg":62533.9,"rally_latency_50_avg":552.2,"rally_latency_99_avg":3396.3,"rally_gc_young_avg":1.54,"indexing_time_avg":42.71,"merge_time_avg":18.87,"coldstart_avg":13777,"sequential_index_avg":2032,"bulk_index_avg":353,"search_match_all_avg":21,"search_term_avg":12},
            {"instance":"r7gd.xlarge","arch":"Graviton","gen":3,"family":"R","rally_throughput_avg":60873.7,"rally_latency_50_avg":559.3,"rally_latency_99_avg":3463.6,"rally_gc_young_avg":1.63,"indexing_time_avg":41.75,"merge_time_avg":15.35,"coldstart_avg":13897,"sequential_index_avg":1865,"bulk_index_avg":353,"search_match_all_avg":22,"search_term_avg":11},
            {"instance":"m7i-flex.xlarge","arch":"Intel","gen":7,"family":"M","rally_throughput_avg":60146.2,"rally_latency_50_avg":549.4,"rally_latency_99_avg":3373.1,"rally_gc_young_avg":2.76,"indexing_time_avg":32.69,"merge_time_avg":12.49,"coldstart_avg":13868,"sequential_index_avg":2047,"bulk_index_avg":291,"search_match_all_avg":14,"search_term_avg":9},
            {"instance":"m7g.xlarge","arch":"Graviton","gen":3,"family":"M","rally_throughput_avg":59617.3,"rally_latency_50_avg":573.3,"rally_latency_99_avg":3832.9,"rally_gc_young_avg":1.64,"indexing_time_avg":66.01,"merge_time_avg":29.86,"coldstart_avg":12805,"sequential_index_avg":1866,"bulk_index_avg":335,"search_match_all_avg":20,"search_term_avg":11},
            {"instance":"m7i.xlarge","arch":"Intel","gen":7,"family":"M","rally_throughput_avg":55428.9,"rally_latency_50_avg":637.5,"rally_latency_99_avg":4188.7,"rally_gc_young_avg":2.95,"indexing_time_avg":47.91,"merge_time_avg":19.35,"coldstart_avg":12658,"sequential_index_avg":2170,"bulk_index_avg":310,"search_match_all_avg":17,"search_term_avg":9},
            {"instance":"r7i.xlarge","arch":"Intel","gen":7,"family":"R","rally_throughput_avg":54485.8,"rally_latency_50_avg":624.4,"rally_latency_99_avg":3812.0,"rally_gc_young_avg":2.99,"indexing_time_avg":47.25,"merge_time_avg":17.08,"coldstart_avg":14914,"sequential_index_avg":2609,"bulk_index_avg":302,"search_match_all_avg":17,"search_term_avg":8},
            {"instance":"c7i.xlarge","arch":"Intel","gen":7,"family":"C","rally_throughput_avg":52309.6,"rally_latency_50_avg":633.8,"rally_latency_99_avg":3933.2,"rally_gc_young_avg":3.21,"indexing_time_avg":40.91,"merge_time_avg":19.45,"coldstart_avg":15856,"sequential_index_avg":1812,"bulk_index_avg":301,"search_match_all_avg":15,"search_term_avg":8},
            {"instance":"m6id.xlarge","arch":"Intel","gen":6,"family":"M","rally_throughput_avg":51738.0,"rally_latency_50_avg":682.1,"rally_latency_99_avg":4424.7,"rally_gc_young_avg":2.95,"indexing_time_avg":52.35,"merge_time_avg":20.91,"coldstart_avg":14356,"sequential_index_avg":2203,"bulk_index_avg":378,"search_match_all_avg":21,"search_term_avg":10},
            {"instance":"m6idn.xlarge","arch":"Intel","gen":6,"family":"M","rally_throughput_avg":51696.4,"rally_latency_50_avg":663.8,"rally_latency_99_avg":3918.2,"rally_gc_young_avg":2.91,"indexing_time_avg":38.09,"merge_time_avg":14.01,"coldstart_avg":15252,"sequential_index_avg":1981,"bulk_index_avg":340,"search_match_all_avg":20,"search_term_avg":10},
            {"instance":"c6in.xlarge","arch":"Intel","gen":6,"family":"C","rally_throughput_avg":51559.0,"rally_latency_50_avg":669.6,"rally_latency_99_avg":4891.5,"rally_gc_young_avg":3.06,"indexing_time_avg":52.84,"merge_time_avg":25.4,"coldstart_avg":15696,"sequential_index_avg":1820,"bulk_index_avg":348,"search_match_all_avg":17,"search_term_avg":9},
            {"instance":"m6in.xlarge","arch":"Intel","gen":6,"family":"M","rally_throughput_avg":51402.5,"rally_latency_50_avg":675.8,"rally_latency_99_avg":4296.7,"rally_gc_young_avg":2.99,"indexing_time_avg":55.17,"merge_time_avg":23.53,"coldstart_avg":14796,"sequential_index_avg":2109,"bulk_index_avg":352,"search_match_all_avg":18,"search_term_avg":9},
            {"instance":"c6id.xlarge","arch":"Intel","gen":6,"family":"C","rally_throughput_avg":50605.6,"rally_latency_50_avg":692.8,"rally_latency_99_avg":4780.7,"rally_gc_young_avg":3.0,"indexing_time_avg":56.52,"merge_time_avg":26.53,"coldstart_avg":17010,"sequential_index_avg":1851,"bulk_index_avg":344,"search_match_all_avg":18,"search_term_avg":10},
            {"instance":"r6i.xlarge","arch":"Intel","gen":6,"family":"R","rally_throughput_avg":50399.7,"rally_latency_50_avg":698.0,"rally_latency_99_avg":4292.8,"rally_gc_young_avg":3.12,"indexing_time_avg":55.65,"merge_time_avg":20.18,"coldstart_avg":15901,"sequential_index_avg":3100,"bulk_index_avg":371,"search_match_all_avg":34,"search_term_avg":14},
            {"instance":"m6i.xlarge","arch":"Intel","gen":6,"family":"M","rally_throughput_avg":49589.6,"rally_latency_50_avg":689.6,"rally_latency_99_avg":4604.7,"rally_gc_young_avg":2.96,"indexing_time_avg":54.09,"merge_time_avg":24.92,"coldstart_avg":15454,"sequential_index_avg":2088,"bulk_index_avg":346,"search_match_all_avg":20,"search_term_avg":9},
            {"instance":"c6i.xlarge","arch":"Intel","gen":6,"family":"C","rally_throughput_avg":49230.0,"rally_latency_50_avg":700.0,"rally_latency_99_avg":4727.3,"rally_gc_young_avg":3.18,"indexing_time_avg":56.22,"merge_time_avg":24.85,"coldstart_avg":17229,"sequential_index_avg":1985,"bulk_index_avg":358,"search_match_all_avg":19,"search_term_avg":14},
            {"instance":"r6gd.xlarge","arch":"Graviton","gen":2,"family":"R","rally_throughput_avg":48666.5,"rally_latency_50_avg":707.0,"rally_latency_99_avg":4779.1,"rally_gc_young_avg":2.18,"indexing_time_avg":58.64,"merge_time_avg":24.32,"coldstart_avg":18343,"sequential_index_avg":2375,"bulk_index_avg":446,"search_match_all_avg":27,"search_term_avg":14},
            {"instance":"r6id.xlarge","arch":"Intel","gen":6,"family":"R","rally_throughput_avg":48543.8,"rally_latency_50_avg":731.6,"rally_latency_99_avg":5099.5,"rally_gc_young_avg":3.43,"indexing_time_avg":53.53,"merge_time_avg":21.77,"coldstart_avg":15629,"sequential_index_avg":3228,"bulk_index_avg":369,"search_match_all_avg":26,"search_term_avg":10},
            {"instance":"m5zn.xlarge","arch":"Intel","gen":5,"family":"M","rally_throughput_avg":48125.3,"rally_latency_50_avg":708.7,"rally_latency_99_avg":5219.7,"rally_gc_young_avg":3.21,"indexing_time_avg":53.45,"merge_time_avg":21.16,"coldstart_avg":15588,"sequential_index_avg":2005,"bulk_index_avg":338,"search_match_all_avg":21,"search_term_avg":10},
            {"instance":"m6g.xlarge","arch":"Graviton","gen":2,"family":"M","rally_throughput_avg":47725.9,"rally_latency_50_avg":711.2,"rally_latency_99_avg":4681.5,"rally_gc_young_avg":2.17,"indexing_time_avg":53.99,"merge_time_avg":22.67,"coldstart_avg":17794,"sequential_index_avg":2702,"bulk_index_avg":477,"search_match_all_avg":27,"search_term_avg":14},
            {"instance":"c6gd.xlarge","arch":"Graviton","gen":2,"family":"C","rally_throughput_avg":47171.8,"rally_latency_50_avg":719.8,"rally_latency_99_avg":4647.2,"rally_gc_young_avg":2.11,"indexing_time_avg":58.87,"merge_time_avg":26.6,"coldstart_avg":17328,"sequential_index_avg":2390,"bulk_index_avg":445,"search_match_all_avg":24,"search_term_avg":14},
            {"instance":"c6gn.xlarge","arch":"Graviton","gen":2,"family":"C","rally_throughput_avg":46480.8,"rally_latency_50_avg":712.9,"rally_latency_99_avg":4150.3,"rally_gc_young_avg":2.21,"indexing_time_avg":52.2,"merge_time_avg":22.42,"coldstart_avg":16802,"sequential_index_avg":2250,"bulk_index_avg":449,"search_match_all_avg":23,"search_term_avg":13},
            {"instance":"m6gd.xlarge","arch":"Graviton","gen":2,"family":"M","rally_throughput_avg":46213.4,"rally_latency_50_avg":836.4,"rally_latency_99_avg":4949.2,"rally_gc_young_avg":2.55,"indexing_time_avg":75.5,"merge_time_avg":30.78,"coldstart_avg":17205,"sequential_index_avg":2589,"bulk_index_avg":441,"search_match_all_avg":23,"search_term_avg":12},
            {"instance":"r6g.xlarge","arch":"Graviton","gen":2,"family":"R","rally_throughput_avg":45995.4,"rally_latency_50_avg":734.0,"rally_latency_99_avg":4999.7,"rally_gc_young_avg":2.17,"indexing_time_avg":57.76,"merge_time_avg":22.03,"coldstart_avg":19529,"sequential_index_avg":2731,"bulk_index_avg":479,"search_match_all_avg":26,"search_term_avg":14},
            {"instance":"c6g.xlarge","arch":"Graviton","gen":2,"family":"C","rally_throughput_avg":44950.7,"rally_latency_50_avg":727.9,"rally_latency_99_avg":5100.9,"rally_gc_young_avg":2.2,"indexing_time_avg":44.72,"merge_time_avg":17.99,"coldstart_avg":16997,"sequential_index_avg":2477,"bulk_index_avg":458,"search_match_all_avg":24,"search_term_avg":13},
            {"instance":"c5d.xlarge","arch":"Intel","gen":5,"family":"C","rally_throughput_avg":40986.7,"rally_latency_50_avg":821.9,"rally_latency_99_avg":5739.9,"rally_gc_young_avg":3.54,"indexing_time_avg":50.75,"merge_time_avg":21.16,"coldstart_avg":19575,"sequential_index_avg":2410,"bulk_index_avg":427,"search_match_all_avg":23,"search_term_avg":12},
            {"instance":"m5d.xlarge","arch":"Intel","gen":5,"family":"M","rally_throughput_avg":40571.2,"rally_latency_50_avg":819.2,"rally_latency_99_avg":4904.4,"rally_gc_young_avg":3.59,"indexing_time_avg":53.51,"merge_time_avg":21.11,"coldstart_avg":17829,"sequential_index_avg":2434,"bulk_index_avg":411,"search_match_all_avg":26,"search_term_avg":12},
            {"instance":"c5.xlarge","arch":"Intel","gen":5,"family":"C","rally_throughput_avg":39928.0,"rally_latency_50_avg":822.6,"rally_latency_99_avg":5985.9,"rally_gc_young_avg":3.55,"indexing_time_avg":34.71,"merge_time_avg":12.81,"coldstart_avg":17607,"sequential_index_avg":2064,"bulk_index_avg":388,"search_match_all_avg":20,"search_term_avg":13},
            {"instance":"c5a.xlarge","arch":"AMD","gen":5,"family":"C","rally_throughput_avg":39864.9,"rally_latency_50_avg":764.8,"rally_latency_99_avg":4878.3,"rally_gc_young_avg":3.05,"indexing_time_avg":40.59,"merge_time_avg":15.88,"coldstart_avg":17516,"sequential_index_avg":2379,"bulk_index_avg":382,"search_match_all_avg":24,"search_term_avg":14},
            {"instance":"r5dn.xlarge","arch":"Intel","gen":5,"family":"R","rally_throughput_avg":38953.2,"rally_latency_50_avg":842.9,"rally_latency_99_avg":5785.6,"rally_gc_young_avg":3.6,"indexing_time_avg":69.82,"merge_time_avg":29.74,"coldstart_avg":20847,"sequential_index_avg":2713,"bulk_index_avg":435,"search_match_all_avg":30,"search_term_avg":14},
            {"instance":"m5.xlarge","arch":"Intel","gen":5,"family":"M","rally_throughput_avg":38454.4,"rally_latency_50_avg":852.5,"rally_latency_99_avg":6004.9,"rally_gc_young_avg":3.61,"indexing_time_avg":56.74,"merge_time_avg":21.83,"coldstart_avg":18174,"sequential_index_avg":2561,"bulk_index_avg":433,"search_match_all_avg":26,"search_term_avg":12},
            {"instance":"r5d.xlarge","arch":"Intel","gen":5,"family":"R","rally_throughput_avg":37203.9,"rally_latency_50_avg":933.1,"rally_latency_99_avg":6696.6,"rally_gc_young_avg":3.74,"indexing_time_avg":75.52,"merge_time_avg":29.57,"coldstart_avg":19889,"sequential_index_avg":2722,"bulk_index_avg":405,"search_match_all_avg":26,"search_term_avg":15},
            {"instance":"r5.xlarge","arch":"Intel","gen":5,"family":"R","rally_throughput_avg":36841.4,"rally_latency_50_avg":930.4,"rally_latency_99_avg":5579.2,"rally_gc_young_avg":3.7,"indexing_time_avg":56.81,"merge_time_avg":19.73,"coldstart_avg":20516,"sequential_index_avg":2612,"bulk_index_avg":413,"search_match_all_avg":25,"search_term_avg":14},
            {"instance":"r5b.xlarge","arch":"Intel","gen":5,"family":"R","rally_throughput_avg":36731.8,"rally_latency_50_avg":967.0,"rally_latency_99_avg":6078.0,"rally_gc_young_avg":3.77,"indexing_time_avg":58.6,"merge_time_avg":21.67,"coldstart_avg":21041,"sequential_index_avg":2674,"bulk_index_avg":414,"search_match_all_avg":30,"search_term_avg":16},
            {"instance":"c5n.xlarge","arch":"Intel","gen":5,"family":"C","rally_throughput_avg":35366.8,"rally_latency_50_avg":1057.6,"rally_latency_99_avg":6126.2,"rally_gc_young_avg":4.82,"indexing_time_avg":108.91,"merge_time_avg":56.97,"coldstart_avg":17145,"sequential_index_avg":2490,"bulk_index_avg":398,"search_match_all_avg":25,"search_term_avg":14},
            {"instance":"r5n.xlarge","arch":"Intel","gen":5,"family":"R","rally_throughput_avg":35266.7,"rally_latency_50_avg":1010.2,"rally_latency_99_avg":5875.7,"rally_gc_young_avg":4.24,"indexing_time_avg":87.33,"merge_time_avg":40.1,"coldstart_avg":21336,"sequential_index_avg":2768,"bulk_index_avg":440,"search_match_all_avg":null,"search_term_avg":null},
            {"instance":"r5ad.xlarge","arch":"AMD","gen":5,"family":"R","rally_throughput_avg":31765.9,"rally_latency_50_avg":1081.4,"rally_latency_99_avg":8048.4,"rally_gc_young_avg":4.59,"indexing_time_avg":93.92,"merge_time_avg":36.71,"coldstart_avg":26246,"sequential_index_avg":4219,"bulk_index_avg":626,"search_match_all_avg":36,"search_term_avg":22},
            {"instance":"m5a.xlarge","arch":"AMD","gen":5,"family":"M","rally_throughput_avg":30182.8,"rally_latency_50_avg":1084.8,"rally_latency_99_avg":8173.8,"rally_gc_young_avg":4.35,"indexing_time_avg":92.07,"merge_time_avg":38.19,"coldstart_avg":25252,"sequential_index_avg":3508,"bulk_index_avg":564,"search_match_all_avg":null,"search_term_avg":null},
            {"instance":"r5a.xlarge","arch":"AMD","gen":5,"family":"R","rally_throughput_avg":29949.8,"rally_latency_50_avg":1091.5,"rally_latency_99_avg":8439.9,"rally_gc_young_avg":4.57,"indexing_time_avg":92.74,"merge_time_avg":36.11,"coldstart_avg":26694,"sequential_index_avg":3760,"bulk_index_avg":572,"search_match_all_avg":37,"search_term_avg":22},
            {"instance":"m5ad.xlarge","arch":"AMD","gen":5,"family":"M","rally_throughput_avg":28123.5,"rally_latency_50_avg":1235.5,"rally_latency_99_avg":7718.8,"rally_gc_young_avg":5.19,"indexing_time_avg":90.05,"merge_time_avg":34.96,"coldstart_avg":24494,"sequential_index_avg":3414,"bulk_index_avg":553,"search_match_all_avg":39,"search_term_avg":21}
        ];

        // Instance pricing data (USD/hour, ap-northeast-2)
        const instancePricing = {
            "c5.xlarge": 0.192, "c5a.xlarge": 0.172, "c5d.xlarge": 0.218, "c5n.xlarge": 0.246,
            "c6g.xlarge": 0.154, "c6gd.xlarge": 0.185, "c6gn.xlarge": 0.194, "c6i.xlarge": 0.192,
            "c6id.xlarge": 0.238, "c6in.xlarge": 0.254, "c7g.xlarge": 0.163, "c7gd.xlarge": 0.205,
            "c7i.xlarge": 0.202, "c7i-flex.xlarge": 0.182, "c8g.xlarge": 0.163, "c8i.xlarge": 0.202,
            "c8i-flex.xlarge": 0.182,
            "m5.xlarge": 0.240, "m5a.xlarge": 0.216, "m5ad.xlarge": 0.262, "m5d.xlarge": 0.286,
            "m5zn.xlarge": 0.376, "m6g.xlarge": 0.192, "m6gd.xlarge": 0.238, "m6i.xlarge": 0.240,
            "m6id.xlarge": 0.302, "m6idn.xlarge": 0.362, "m6in.xlarge": 0.318, "m7g.xlarge": 0.204,
            "m7gd.xlarge": 0.257, "m7i.xlarge": 0.252, "m7i-flex.xlarge": 0.227, "m8g.xlarge": 0.204,
            "m8i.xlarge": 0.252,
            "r5.xlarge": 0.302, "r5a.xlarge": 0.272, "r5ad.xlarge": 0.330, "r5b.xlarge": 0.356,
            "r5d.xlarge": 0.360, "r5dn.xlarge": 0.400, "r5n.xlarge": 0.356, "r6g.xlarge": 0.242,
            "r6gd.xlarge": 0.300, "r6i.xlarge": 0.302, "r6id.xlarge": 0.378, "r7g.xlarge": 0.256,
            "r7gd.xlarge": 0.323, "r7i.xlarge": 0.318, "r8g.xlarge": 0.256, "r8i.xlarge": 0.318,
            "r8i-flex.xlarge": 0.286
        };

        // Helper functions
        function getColor(arch) {
            if (arch === 'Graviton') return 'rgba(16, 185, 129, 0.8)';
            if (arch === 'AMD') return 'rgba(239, 68, 68, 0.8)';
            return 'rgba(59, 130, 246, 0.8)';
        }
        function getBorderColor(arch) {
            if (arch === 'Graviton') return 'rgb(16, 185, 129)';
            if (arch === 'AMD') return 'rgb(239, 68, 68)';
            return 'rgb(59, 130, 246)';
        }

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // Expandable card details
        function toggleDetails(btn) {
            const details = btn.nextElementSibling;
            details.classList.toggle('expanded');
            btn.textContent = details.classList.contains('expanded') ? '접기' : '상세 보기';
        }

        // Toggle button activation
        function setActiveToggle(btn) {
            btn.parentElement.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        // Rally Chart
        let rallyChart;
        function createRallyChart() {
            const top20 = benchmarkData.slice(0, 20);
            const ctx = document.getElementById('rallyChart').getContext('2d');
            rallyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: top20.map(d => d.instance),
                    datasets: [{
                        label: 'Throughput (docs/s)',
                        data: top20.map(d => d.rally_throughput_avg),
                        backgroundColor: top20.map(d => getColor(d.arch)),
                        borderColor: top20.map(d => getBorderColor(d.arch)),
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: ctx => `${ctx.parsed.x.toLocaleString()} docs/s`
                            }
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Throughput (docs/s) - Higher is better' } }
                    }
                }
            });
        }

        function updateRallyChart(metric) {
            setActiveToggle(event.target);
            let top20, label, format, xLabel;

            if (metric === 'throughput') {
                top20 = [...benchmarkData].sort((a, b) => b.rally_throughput_avg - a.rally_throughput_avg).slice(0, 20);
                label = 'Throughput (docs/s)';
                format = v => `${v.toLocaleString()} docs/s`;
                xLabel = 'Throughput (docs/s) - Higher is better';
            } else if (metric === 'latency50') {
                top20 = [...benchmarkData].sort((a, b) => a.rally_latency_50_avg - b.rally_latency_50_avg).slice(0, 20);
                label = 'Latency p50 (ms)';
                format = v => `${v.toFixed(1)} ms`;
                xLabel = 'Latency p50 (ms) - Lower is better';
            } else if (metric === 'latency99') {
                top20 = [...benchmarkData].sort((a, b) => a.rally_latency_99_avg - b.rally_latency_99_avg).slice(0, 20);
                label = 'Latency p99 (ms)';
                format = v => `${v.toFixed(1)} ms`;
                xLabel = 'Latency p99 (ms) - Lower is better';
            } else if (metric === 'gc') {
                top20 = [...benchmarkData].sort((a, b) => a.rally_gc_young_avg - b.rally_gc_young_avg).slice(0, 20);
                label = 'GC Time (s)';
                format = v => `${v.toFixed(2)} s`;
                xLabel = 'GC Time (s) - Lower is better';
            } else if (metric === 'indexing') {
                top20 = [...benchmarkData].filter(d => d.indexing_time_avg).sort((a, b) => a.indexing_time_avg - b.indexing_time_avg).slice(0, 20);
                label = 'Indexing Time (min)';
                format = v => `${v.toFixed(1)} min`;
                xLabel = 'Cumulative Indexing Time (min) - Lower is better';
            } else if (metric === 'merge') {
                top20 = [...benchmarkData].filter(d => d.merge_time_avg).sort((a, b) => a.merge_time_avg - b.merge_time_avg).slice(0, 20);
                label = 'Merge Time (min)';
                format = v => `${v.toFixed(1)} min`;
                xLabel = 'Cumulative Merge Time (min) - Lower is better';
            }

            rallyChart.data.labels = top20.map(d => d.instance);
            rallyChart.data.datasets[0].data = top20.map(d => {
                if (metric === 'throughput') return d.rally_throughput_avg;
                if (metric === 'latency50') return d.rally_latency_50_avg;
                if (metric === 'latency99') return d.rally_latency_99_avg;
                if (metric === 'gc') return d.rally_gc_young_avg;
                if (metric === 'indexing') return d.indexing_time_avg;
                if (metric === 'merge') return d.merge_time_avg;
            });
            rallyChart.data.datasets[0].label = label;
            rallyChart.data.datasets[0].backgroundColor = top20.map(d => getColor(d.arch));
            rallyChart.data.datasets[0].borderColor = top20.map(d => getBorderColor(d.arch));
            rallyChart.options.plugins.tooltip.callbacks.label = ctx => format(ctx.parsed.x);
            rallyChart.options.scales.x.title.text = xLabel;
            rallyChart.update();
        }

        // Coldstart Chart
        let coldstartChart;
        function createColdstartChart() {
            const sorted = [...benchmarkData].sort((a, b) => a.coldstart_avg - b.coldstart_avg).slice(0, 20);
            const ctx = document.getElementById('coldstartChart').getContext('2d');
            coldstartChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sorted.map(d => d.instance),
                    datasets: [{
                        label: 'Cold Start (s)',
                        data: sorted.map(d => d.coldstart_avg / 1000),
                        backgroundColor: sorted.map(d => getColor(d.arch)),
                        borderColor: sorted.map(d => getBorderColor(d.arch)),
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: ctx => `${ctx.parsed.x.toFixed(2)}s`
                            }
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Cold Start (s) - Lower is better' } }
                    }
                }
            });
        }

        function updateColdstartChart(metric) {
            setActiveToggle(event.target);
            let sorted, label, format, xLabel;

            if (metric === 'coldstart') {
                sorted = [...benchmarkData].sort((a, b) => a.coldstart_avg - b.coldstart_avg).slice(0, 20);
                label = 'Cold Start (s)';
                format = v => `${v.toFixed(2)}s`;
                xLabel = 'Cold Start (s) - Lower is better';
            } else if (metric === 'sequential') {
                sorted = [...benchmarkData].filter(d => d.sequential_index_avg).sort((a, b) => a.sequential_index_avg - b.sequential_index_avg).slice(0, 20);
                label = 'Sequential Index (ms)';
                format = v => `${v.toFixed(0)} ms`;
                xLabel = 'Sequential Index 100 docs (ms) - Lower is better';
            } else if (metric === 'bulk') {
                sorted = [...benchmarkData].sort((a, b) => a.bulk_index_avg - b.bulk_index_avg).slice(0, 20);
                label = 'Bulk Index (ms)';
                format = v => `${v.toFixed(0)} ms`;
                xLabel = 'Bulk Index 1000 docs (ms) - Lower is better';
            } else if (metric === 'search_match_all') {
                sorted = [...benchmarkData].filter(d => d.search_match_all_avg).sort((a, b) => a.search_match_all_avg - b.search_match_all_avg).slice(0, 20);
                label = 'Search match_all (ms)';
                format = v => `${v.toFixed(0)} ms`;
                xLabel = 'Search match_all (ms) - Lower is better';
            } else if (metric === 'search_term') {
                sorted = [...benchmarkData].filter(d => d.search_term_avg).sort((a, b) => a.search_term_avg - b.search_term_avg).slice(0, 20);
                label = 'Search term (ms)';
                format = v => `${v.toFixed(0)} ms`;
                xLabel = 'Search term (ms) - Lower is better';
            }

            coldstartChart.data.labels = sorted.map(d => d.instance);
            coldstartChart.data.datasets[0].data = sorted.map(d => {
                if (metric === 'coldstart') return d.coldstart_avg / 1000;
                if (metric === 'sequential') return d.sequential_index_avg;
                if (metric === 'bulk') return d.bulk_index_avg;
                if (metric === 'search_match_all') return d.search_match_all_avg;
                if (metric === 'search_term') return d.search_term_avg;
            });
            coldstartChart.data.datasets[0].label = label;
            coldstartChart.data.datasets[0].backgroundColor = sorted.map(d => getColor(d.arch));
            coldstartChart.data.datasets[0].borderColor = sorted.map(d => getBorderColor(d.arch));
            coldstartChart.options.plugins.tooltip.callbacks.label = ctx => format(ctx.parsed.x);
            coldstartChart.options.scales.x.title.text = xLabel;
            coldstartChart.update();
        }

        // Architecture Chart
        function createArchChart() {
            const graviton = benchmarkData.filter(d => d.arch === 'Graviton');
            const intel = benchmarkData.filter(d => d.arch === 'Intel');
            const amd = benchmarkData.filter(d => d.arch === 'AMD');

            const avgG = graviton.reduce((s, d) => s + d.rally_throughput_avg, 0) / graviton.length;
            const avgI = intel.reduce((s, d) => s + d.rally_throughput_avg, 0) / intel.length;
            const avgA = amd.reduce((s, d) => s + d.rally_throughput_avg, 0) / amd.length;

            new Chart(document.getElementById('archChart'), {
                type: 'bar',
                data: {
                    labels: ['Graviton', 'Intel', 'AMD'],
                    datasets: [{
                        label: 'Avg Throughput (docs/s)',
                        data: [avgG, avgI, avgA],
                        backgroundColor: ['rgba(16, 185, 129, 0.8)', 'rgba(59, 130, 246, 0.8)', 'rgba(239, 68, 68, 0.8)'],
                        borderColor: ['rgb(16, 185, 129)', 'rgb(59, 130, 246)', 'rgb(239, 68, 68)'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: ctx => `${ctx.parsed.y.toLocaleString()} docs/s` } }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Throughput (docs/s)' } }
                    }
                }
            });
        }

        // Generation Chart
        function createGenChart() {
            const genGroups = {
                'Graviton2': benchmarkData.filter(d => d.arch === 'Graviton' && d.gen === 2),
                'Graviton3': benchmarkData.filter(d => d.arch === 'Graviton' && d.gen === 3),
                'Graviton4': benchmarkData.filter(d => d.arch === 'Graviton' && d.gen === 4),
                'Intel 5th': benchmarkData.filter(d => d.arch === 'Intel' && d.gen === 5),
                'Intel 6th': benchmarkData.filter(d => d.arch === 'Intel' && d.gen === 6),
                'Intel 7th': benchmarkData.filter(d => d.arch === 'Intel' && d.gen === 7),
                'Intel 8th': benchmarkData.filter(d => d.arch === 'Intel' && d.gen === 8)
            };

            const labels = Object.keys(genGroups);
            const avgs = labels.map(k => {
                const g = genGroups[k];
                return g.length ? g.reduce((s, d) => s + d.rally_throughput_avg, 0) / g.length : 0;
            });

            new Chart(document.getElementById('genChart'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Avg Throughput (docs/s)',
                        data: avgs,
                        backgroundColor: labels.map(l => l.includes('Graviton') ? 'rgba(16, 185, 129, 0.8)' : 'rgba(59, 130, 246, 0.8)'),
                        borderColor: labels.map(l => l.includes('Graviton') ? 'rgb(16, 185, 129)' : 'rgb(59, 130, 246)'),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Throughput (docs/s)' } }
                    }
                }
            });
        }

        // Family Chart
        function createFamilyChart() {
            const families = ['C', 'M', 'R'];
            const familyData = families.map(f => {
                const fd = benchmarkData.filter(d => d.family === f);
                return fd.reduce((s, d) => s + d.rally_throughput_avg, 0) / fd.length;
            });

            new Chart(document.getElementById('familyChart'), {
                type: 'bar',
                data: {
                    labels: ['C (Compute)', 'M (General)', 'R (Memory)'],
                    datasets: [{
                        label: 'Avg Throughput (docs/s)',
                        data: familyData,
                        backgroundColor: ['rgba(59, 130, 246, 0.8)', 'rgba(168, 85, 247, 0.8)', 'rgba(236, 72, 153, 0.8)'],
                        borderColor: ['rgb(59, 130, 246)', 'rgb(168, 85, 247)', 'rgb(236, 72, 153)'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Throughput (docs/s)' } }
                    }
                }
            });
        }

        // Cost Efficiency Chart (Performance per Dollar)
        function createCostEfficiencyChart() {
            // Calculate performance per dollar and sort by efficiency
            const efficiencyData = benchmarkData
                .filter(d => instancePricing[d.instance])
                .map(d => ({
                    instance: d.instance,
                    arch: d.arch,
                    throughput: d.rally_throughput_avg,
                    price: instancePricing[d.instance],
                    efficiency: d.rally_throughput_avg / instancePricing[d.instance]
                }))
                .sort((a, b) => b.efficiency - a.efficiency)
                .slice(0, 20);

            new Chart(document.getElementById('costEfficiencyChart'), {
                type: 'bar',
                data: {
                    labels: efficiencyData.map(d => d.instance),
                    datasets: [{
                        label: 'Performance/Dollar (docs/s per $/hr)',
                        data: efficiencyData.map(d => Math.round(d.efficiency)),
                        backgroundColor: efficiencyData.map(d => getColor(d.arch)),
                        borderColor: efficiencyData.map(d => getBorderColor(d.arch)),
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: ctx => {
                                    const d = efficiencyData[ctx.dataIndex];
                                    return [
                                        `가성비: ${Math.round(d.efficiency).toLocaleString()} docs/s per $/hr`,
                                        `처리량: ${d.throughput.toLocaleString()} docs/s`,
                                        `가격: $${d.price.toFixed(3)}/hr`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Performance per Dollar (docs/s per $/hr) - 높을수록 가성비 우수' },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Price vs Performance Bubble Chart
        function createPricePerformanceChart() {
            const bubbleData = benchmarkData
                .filter(d => instancePricing[d.instance])
                .map(d => ({
                    x: instancePricing[d.instance],
                    y: d.rally_throughput_avg,
                    r: 8,
                    instance: d.instance,
                    arch: d.arch
                }));

            new Chart(document.getElementById('pricePerformanceChart'), {
                type: 'bubble',
                data: {
                    datasets: [
                        {
                            label: 'Graviton',
                            data: bubbleData.filter(d => d.arch === 'Graviton'),
                            backgroundColor: 'rgba(16, 185, 129, 0.6)',
                            borderColor: 'rgb(16, 185, 129)',
                            borderWidth: 1
                        },
                        {
                            label: 'Intel',
                            data: bubbleData.filter(d => d.arch === 'Intel'),
                            backgroundColor: 'rgba(59, 130, 246, 0.6)',
                            borderColor: 'rgb(59, 130, 246)',
                            borderWidth: 1
                        },
                        {
                            label: 'AMD',
                            data: bubbleData.filter(d => d.arch === 'AMD'),
                            backgroundColor: 'rgba(239, 68, 68, 0.6)',
                            borderColor: 'rgb(239, 68, 68)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: { usePointStyle: true, padding: 20 }
                        },
                        tooltip: {
                            callbacks: {
                                label: ctx => {
                                    const d = ctx.raw;
                                    return [
                                        d.instance,
                                        `가격: $${d.x.toFixed(3)}/hr`,
                                        `처리량: ${d.y.toLocaleString()} docs/s`,
                                        `가성비: ${Math.round(d.y / d.x).toLocaleString()} docs/s per $/hr`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: '시간당 비용 ($/hr)' },
                            min: 0.14,
                            max: 0.42
                        },
                        y: {
                            title: { display: true, text: 'Rally 처리량 (docs/s)' },
                            min: 25000,
                            max: 80000
                        }
                    }
                }
            });
        }

        // Scatter Chart (Rally vs Coldstart)
        function createScatterChart() {
            const scatterData = benchmarkData.map(d => ({
                x: d.coldstart_avg / 1000,
                y: d.rally_throughput_avg,
                instance: d.instance,
                arch: d.arch
            }));

            new Chart(document.getElementById('scatterChart'), {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Graviton',
                            data: scatterData.filter(d => d.arch === 'Graviton'),
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: 'rgb(16, 185, 129)',
                            pointRadius: 8
                        },
                        {
                            label: 'Intel',
                            data: scatterData.filter(d => d.arch === 'Intel'),
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: 'rgb(59, 130, 246)',
                            pointRadius: 8
                        },
                        {
                            label: 'AMD',
                            data: scatterData.filter(d => d.arch === 'AMD'),
                            backgroundColor: 'rgba(239, 68, 68, 0.7)',
                            borderColor: 'rgb(239, 68, 68)',
                            pointRadius: 8
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: ctx => `${ctx.raw.instance}: ${ctx.raw.y.toLocaleString()} docs/s, ${ctx.raw.x.toFixed(1)}s`
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: '콜드 스타트 (s) - 낮을수록 좋음' },
                            reverse: false
                        },
                        y: {
                            title: { display: true, text: 'Rally 처리량 (docs/s) - 높을수록 좋음' },
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        // Combined Generation Chart
        function createCombinedGenChart() {
            const genGroups = {
                'Graviton2': benchmarkData.filter(d => d.arch === 'Graviton' && d.gen === 2),
                'Graviton3': benchmarkData.filter(d => d.arch === 'Graviton' && d.gen === 3),
                'Graviton4': benchmarkData.filter(d => d.arch === 'Graviton' && d.gen === 4),
                'Intel 5th': benchmarkData.filter(d => d.arch === 'Intel' && d.gen === 5),
                'Intel 6th': benchmarkData.filter(d => d.arch === 'Intel' && d.gen === 6),
                'Intel 7th': benchmarkData.filter(d => d.arch === 'Intel' && d.gen === 7),
                'Intel 8th': benchmarkData.filter(d => d.arch === 'Intel' && d.gen === 8)
            };

            const labels = Object.keys(genGroups);
            const rallyAvgs = labels.map(k => {
                const g = genGroups[k];
                return g.length ? g.reduce((s, d) => s + d.rally_throughput_avg, 0) / g.length : 0;
            });
            const coldstartAvgs = labels.map(k => {
                const g = genGroups[k];
                return g.length ? g.reduce((s, d) => s + d.coldstart_avg, 0) / g.length / 1000 : 0;
            });

            new Chart(document.getElementById('combinedGenChart'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Rally Throughput (docs/s)',
                            data: rallyAvgs,
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: 'rgb(59, 130, 246)',
                            borderWidth: 2,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Cold Start (s)',
                            data: coldstartAvgs,
                            backgroundColor: 'rgba(239, 68, 68, 0.7)',
                            borderColor: 'rgb(239, 68, 68)',
                            borderWidth: 2,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            position: 'left',
                            title: { display: true, text: 'Throughput (docs/s)' },
                            beginAtZero: true
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            title: { display: true, text: 'Cold Start (s)' },
                            beginAtZero: true,
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // Table rendering
        function renderTable(data) {
            const tbody = document.querySelector('#dataTable tbody');
            tbody.innerHTML = '';
            data.forEach((d, i) => {
                const badgeClass = d.arch === 'Graviton' ? 'graviton' : (d.arch === 'AMD' ? 'amd' : 'intel');
                const genLabel = d.arch === 'Graviton' ? `G${d.gen}` : d.gen;
                tbody.innerHTML += `
                    <tr>
                        <td>${i + 1}</td>
                        <td><strong>${d.instance}</strong></td>
                        <td><span class="badge ${badgeClass}">${d.arch}</span></td>
                        <td>${genLabel}</td>
                        <td>${d.family}</td>
                        <td>${d.rally_throughput_avg.toLocaleString()}</td>
                        <td>${d.rally_latency_50_avg.toFixed(1)}</td>
                        <td>${d.rally_latency_99_avg.toFixed(1)}</td>
                        <td>${d.indexing_time_avg ? d.indexing_time_avg.toFixed(1) : '-'}</td>
                        <td>${d.merge_time_avg ? d.merge_time_avg.toFixed(1) : '-'}</td>
                        <td>${(d.coldstart_avg / 1000).toFixed(2)}</td>
                        <td>${d.sequential_index_avg || '-'}</td>
                        <td>${d.bulk_index_avg}</td>
                        <td>${d.search_match_all_avg || '-'}</td>
                        <td>${d.search_term_avg || '-'}</td>
                    </tr>
                `;
            });
        }

        function filterTable() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const arch = document.getElementById('archFilter').value;
            const gen = document.getElementById('genFilter').value;
            const family = document.getElementById('familyFilter').value;

            let filtered = benchmarkData;
            if (search) filtered = filtered.filter(d => d.instance.toLowerCase().includes(search));
            if (arch) filtered = filtered.filter(d => d.arch === arch);
            if (gen) filtered = filtered.filter(d => d.gen === parseInt(gen));
            if (family) filtered = filtered.filter(d => d.family === family);

            renderTable(filtered);
        }

        // Table sorting
        let sortDir = 1;
        let lastCol = -1;
        function sortTable(col) {
            if (lastCol === col) sortDir *= -1;
            else sortDir = 1;
            lastCol = col;

            const keys = ['rank', 'instance', 'arch', 'gen', 'family', 'rally_throughput_avg', 'rally_latency_50_avg', 'rally_latency_99_avg', 'indexing_time_avg', 'merge_time_avg', 'coldstart_avg', 'sequential_index_avg', 'bulk_index_avg', 'search_match_all_avg', 'search_term_avg'];
            const key = keys[col];

            const sorted = [...benchmarkData].sort((a, b) => {
                let va = a[key], vb = b[key];
                if (key === 'coldstart_avg') { va = va / 1000; vb = vb / 1000; }
                if (typeof va === 'string') return sortDir * va.localeCompare(vb);
                return sortDir * (va - vb);
            });
            renderTable(sorted);
        }

        // Initialize all charts
        createRallyChart();
        createColdstartChart();
        createArchChart();
        createGenChart();
        createFamilyChart();
        createCostEfficiencyChart();
        createPricePerformanceChart();
        createScatterChart();
        createCombinedGenChart();
        renderTable(benchmarkData);
    </script>
</body>
</html>
